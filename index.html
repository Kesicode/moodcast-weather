<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MoodCast Weather</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: #f5f7fa;
      color: #333;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: background-color 1s ease;
    }
    
    .container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      margin-bottom: 20px;
      width: 100%;
    }
    
    .app-title {
      font-size: 28px;
      font-weight: 700;
      color: #2d3436;
    }
    
    #clock {
      font-size: 18px;
      font-weight: 600;
      color: #636e72;
      background: white;
      padding: 8px 15px;
      border-radius: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .search-container {
      position: relative;
      width: 100%;
      margin-bottom: 25px;
    }
    
    #search-box {
      width: 100%;
      padding: 15px 20px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid #ddd;
      outline: none;
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    
    .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #636e72;
      font-size: 18px;
    }
    
    .main-content {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .weather-panel {
      flex: 1;
      min-width: 300px;
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .location {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 5px;
      color: #2d3436;
    }
    
    .date {
      font-size: 14px;
      color: #636e72;
      margin-bottom: 20px;
    }
    
    .weather-info {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .weather-icon {
      font-size: 64px;
      margin-right: 20px;
      color: #0984e3;
    }
    
    .temperature {
      font-size: 48px;
      font-weight: 700;
      color: #2d3436;
    }
    
    .description {
      font-size: 18px;
      color: #636e72;
      text-transform: capitalize;
    }
    
    .weather-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .detail {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
    }
    
    .detail i {
      font-size: 20px;
      color: #0984e3;
      margin-bottom: 8px;
    }
    
    .detail-value {
      font-weight: 600;
      font-size: 16px;
      color: #2d3436;
    }
    
    .detail-label {
      font-size: 12px;
      color: #636e72;
    }
    
    .food-panel {
      flex: 1;
      min-width: 300px;
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .panel-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 15px;
      color: #2d3436;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .suggestion {
      font-size: 16px;
      margin-bottom: 20px;
      line-height: 1.5;
      color: #2d3436;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
    }
    
    .order-links {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .order-btn {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 10px 20px;
      background: #0984e3;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    
    .order-btn:hover {
      background: #0870c4;
    }
    
    .music-panel {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      margin-bottom: 20px;
    }
    
    .music-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .music-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    #toggle-music {
      background: #0984e3;
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .playlist-controls {
      display: flex;
      gap: 10px;
    }
    
    #prev-track, #next-track {
      background: #f8f9fa;
      border: none;
      color: #0984e3;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .track-info {
      font-size: 14px;
      color: #636e72;
    }
    
    .loader {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #0984e3;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error-message {
      color: #d63031;
      background: rgba(214, 48, 49, 0.1);
      padding: 10px;
      border-radius: 10px;
      margin: 10px 0;
      text-align: center;
      display: none;
    }
    
    .credits {
      text-align: center;
      font-size: 14px;
      color: #636e72;
      margin-top: 20px;
    }
    
    /* Weather condition specific styles */
    body.rainy {
      background-color: #a4b0be;
    }
    
    body.cloudy {
      background-color: #dfe4ea;
    }
    
    body.night {
      background-color: #2c3e50;
      color: #f5f6fa;
    }
    
    body.night .weather-panel,
    body.night .food-panel,
    body.night .music-panel {
      background: #3a5169;
      color: #f5f6fa;
    }
    
    body.night .app-title,
    body.night .location,
    body.night .temperature,
    body.night .detail-value,
    body.night .panel-title {
      color: #f5f6fa;
    }
    
    body.night .detail {
      background: #2c3e50;
    }
    
    body.night #search-box {
      background: #3a5169;
      border-color: #4a6582;
      color: #f5f6fa;
    }
    
    body.night #clock {
      background: #3a5169;
      color: #f5f6fa;
    }
    
    body.sunny {
      background-color: #ffeaa7;
    }
    
    body.snowy {
      background-color: #dfe6e9;
    }
  </style>
</head>
<body class="default">
  <div class="container">
    <header>
      <div class="app-title">MoodCast Weather</div>
      <div id="clock">Loading...</div>
    </header>
    
    <div class="search-container">
      <input id="search-box" type="text" placeholder="Search for a city..." />
      <div class="search-icon"><i class="fas fa-search"></i></div>
    </div>
    
    <div class="loader" id="loader"></div>
    <div class="error-message" id="error-message"></div>
    
    <div class="main-content">
      <div class="weather-panel">
        <div class="location" id="location">Detecting location...</div>
        <div class="date" id="date">--</div>
        
        <div class="weather-info">
          <div class="weather-icon">
            <i class="fas fa-sync-alt" id="weather-icon"></i>
          </div>
          <div>
            <div class="temperature" id="temperature">--Â°C</div>
            <div class="description" id="description">--</div>
          </div>
        </div>
        
        <div class="weather-details">
          <div class="detail">
            <i class="fas fa-wind"></i>
            <div class="detail-value" id="wind">-- km/h</div>
            <div class="detail-label">Wind</div>
          </div>
          
          <div class="detail">
            <i class="fas fa-tint"></i>
            <div class="detail-value" id="humidity">--%</div>
            <div class="detail-label">Humidity</div>
          </div>
          
          <div class="detail">
            <i class="fas fa-compress-alt"></i>
            <div class="detail-value" id="pressure">-- hPa</div>
            <div class="detail-label">Pressure</div>
          </div>
        </div>
      </div>
      
      <div class="food-panel">
        <div class="panel-title">
          <i class="fas fa-utensils"></i>
          Food Suggestions
        </div>
        
        <div class="suggestion" id="food-suggestion">Waiting for weather data...</div>
        
        <div class="order-links">
          <a href="https://www.swiggy.com" target="_blank" class="order-btn">
            <i class="fas fa-utensils"></i> Swiggy
          </a>
          <a href="https://www.zomato.com" target="_blank" class="order-btn">
            <i class="fas fa-pizza-slice"></i> Zomato
          </a>
        </div>
      </div>
    </div>
    
    <div class="music-panel">
      <div class="music-controls">
        <div class="music-info">
          <button id="toggle-music"><i class="fas fa-volume-up"></i></button>
          <div class="track-info" id="track-info">Background music: On</div>
        </div>
        
        <div class="playlist-controls">
          <button id="prev-track"><i class="fas fa-step-backward"></i></button>
          <button id="next-track"><i class="fas fa-step-forward"></i></button>
        </div>
      </div>
    </div>
    
    <div class="credits">
      Powered by OpenWeather | Icons by Font Awesome
    </div>
  </div>

  <!-- Music AutoPlay -->
  <audio id="bg-music" loop></audio>

  <script>
    // --- API KEY ---
    const API_KEY = "7c3d1ea12299e7296a4579929646cb5d"; // OpenWeather API Key

    // --- DOM Elements ---
    const clockElement = document.getElementById("clock");
    const searchBox = document.getElementById("search-box");
    const locationElement = document.getElementById("location");
    const dateElement = document.getElementById("date");
    const weatherIcon = document.getElementById("weather-icon");
    const temperatureElement = document.getElementById("temperature");
    const descriptionElement = document.getElementById("description");
    const windElement = document.getElementById("wind");
    const humidityElement = document.getElementById("humidity");
    const pressureElement = document.getElementById("pressure");
    const foodSuggestionElement = document.getElementById("food-suggestion");
    const music = document.getElementById("bg-music");
    const toggleMusicButton = document.getElementById("toggle-music");
    const prevTrackButton = document.getElementById("prev-track");
    const nextTrackButton = document.getElementById("next-track");
    const trackInfoElement = document.getElementById("track-info");
    const loader = document.getElementById("loader");
    const errorMessage = document.getElementById("error-message");
    const body = document.body;

    // --- State Variables ---
    let isMusicPlaying = true; // Auto-play by default
    let currentWeather = "";
    let currentPlaylist = [];
    let currentTrackIndex = 0;

    // --- MUSIC PLAYLISTS ---
    const playlists = {
      rainy: [
        { 
          name: "Rainy Day Piano", 
          url: "https://cdn.pixabay.com/download/audio/2022/01/20/audio_5be6f5f7c2.mp3?filename=soft-rain-ambient-111154.mp3" 
        },
        { 
          name: "Cozy Rain Sounds", 
          url: "https://cdn.pixabay.com/download/audio/2021/10/25/audio_5d8e401e7c.mp3?filename=rain-on-window-135941.mp3" 
        }
      ],
      snowy: [
        { 
          name: "Warm Fireplace", 
          url: "https://cdn.pixabay.com/download/audio/2022/11/01/audio_eb76b9e8c3.mp3?filename=fireplace-19938.mp3" 
        },
        { 
          name: "Winter Wind", 
          url: "https://cdn.pixabay.com/download/audio/2022/10/13/audio_ecb9c5c3d6.mp3?filename=wind-howling-143128.mp3" 
        }
      ],
      night: [
        { 
          name: "Calm Night", 
          url: "https://cdn.pixabay.com/download/audio/2022/10/25/audio_634dbfb7e4.mp3?filename=night-ambience-28065.mp3" 
        },
        { 
          name: "Crickets Night Sounds", 
          url: "https://cdn.pixabay.com/download/audio/2022/03/22/audio_5b405d6e1a.mp3?filename=crickets-at-night-133034.mp3" 
        }
      ],
      default: [
        { 
          name: "Upbeat Acoustic", 
          url: "https://cdn.pixabay.com/download/audio/2022/10/13/audio_ecb9c5c3d6.mp3?filename=positive-upbeat-acoustic-118945.mp3" 
        },
        { 
          name: "Happy Day", 
          url: "https://cdn.pixabay.com/download/audio/2022/03/19/audio_5b405d6e1a.mp3?filename=happy-day-113985.mp3" 
        }
      ]
    };

    // --- CLOCK & DATE ---
    function updateClock() {
      const now = new Date();
      
      // Update time
      clockElement.innerText = now.toLocaleTimeString([], { 
        hour: "2-digit", 
        minute: "2-digit"
      });
      
      // Update date
      const dateOptions = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
      dateElement.innerText = now.toLocaleDateString('en-US', dateOptions);
    }
    setInterval(updateClock, 1000);
    updateClock();

    // --- WEATHER FUNCTIONS ---
    function showLoader() {
      loader.style.display = 'block';
      errorMessage.style.display = 'none';
    }

    function hideLoader() {
      loader.style.display = 'none';
    }

    function showError(message) {
      errorMessage.innerText = message;
      errorMessage.style.display = 'block';
      hideLoader();
    }

    function setWeatherIcon(iconCode) {
      const iconMap = {
        '01d': 'fa-sun',
        '01n': 'fa-moon',
        '02d': 'fa-cloud-sun',
        '02n': 'fa-cloud-moon',
        '03d': 'fa-cloud',
        '03n': 'fa-cloud',
        '04d': 'fa-cloud',
        '04n': 'fa-cloud',
        '09d': 'fa-cloud-showers-heavy',
        '09n': 'fa-cloud-showers-heavy',
        '10d': 'fa-cloud-sun-rain',
        '10n': 'fa-cloud-moon-rain',
        '11d': 'fa-bolt',
        '11n': 'fa-bolt',
        '13d': 'fa-snowflake',
        '13n': 'fa-snowflake',
        '50d': 'fa-smog',
        '50n': 'fa-smog'
      };
      
      weatherIcon.className = 'fas ' + (iconMap[iconCode] || 'fa-cloud');
    }

    function setMusicPlaylist(weather, isNight) {
      // Determine which playlist to use based on weather
      if (weather.includes("rain")) {
        currentPlaylist = playlists.rainy;
      } else if (weather.includes("snow")) {
        currentPlaylist = playlists.snowy;
      } else if (isNight) {
        currentPlaylist = playlists.night;
      } else {
        currentPlaylist = playlists.default;
      }
      
      // Start playing the first track in the playlist
      currentTrackIndex = 0;
      playCurrentTrack();
    }

    function playCurrentTrack() {
      if (currentPlaylist.length === 0) return;
      
      const track = currentPlaylist[currentTrackIndex];
      music.src = track.url;
      
      if (isMusicPlaying) {
        music.play().catch(e => {
          console.log("Audio play failed:", e);
          isMusicPlaying = false;
          toggleMusicButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
          trackInfoElement.textContent = "Background music: Off";
        });
      }
      
      // Update track info
      if (isMusicPlaying) {
        trackInfoElement.textContent = `Now playing: ${track.name}`;
      }
    }

    function playNextTrack() {
      if (currentPlaylist.length === 0) return;
      
      currentTrackIndex = (currentTrackIndex + 1) % currentPlaylist.length;
      playCurrentTrack();
    }

    function playPrevTrack() {
      if (currentPlaylist.length === 0) return;
      
      currentTrackIndex = (currentTrackIndex - 1 + currentPlaylist.length) % currentPlaylist.length;
      playCurrentTrack();
    }

    function setBackground(weather, isNight) {
      // Remove all weather classes
      body.className = '';
      
      if (weather.includes("rain")) {
        body.classList.add('rainy');
      } else if (weather.includes("cloud")) {
        body.classList.add('cloudy');
      } else if (isNight) {
        body.classList.add('night');
      } else if (weather.includes("clear") || weather.includes("sun")) {
        body.classList.add('sunny');
      } else if (weather.includes("snow")) {
        body.classList.add('snowy');
      } else {
        body.classList.add('default');
      }
    }

    function foodSuggestions(desc) {
      desc = desc.toLowerCase();
      if (desc.includes("rain")) {
        return "â Rainy Day: Hot Soup ð², Pakoras ð¥, Chai â";
      } else if (desc.includes("cloud")) {
        return "âï¸ Cloudy: Coffee â, Sandwich ð¥ª, Warm Cookies ðª";
      } else if (desc.includes("clear") || desc.includes("sun")) {
        return "âï¸ Sunny: Ice Cream ð¦, Cold Drinks ð¥¤, Salad ð¥";
      } else if (desc.includes("snow")) {
        return "âï¸ Snow: Hot Chocolate ð«, Stew ð, Grilled Cheese ð§";
      } else {
        return "ð½ï¸ Anytime: Pizza ð, Burger ð, Pasta ð";
      }
    }

    function updateWeatherUI(data) {
      const temp = Math.round(data.main.temp);
      const desc = data.weather[0].description;
      const icon = data.weather[0].icon;
      const isNight = icon.includes("n");
      currentWeather = desc.toLowerCase();
      
      setWeatherIcon(icon);
      locationElement.innerText = data.name;
      temperatureElement.innerText = `${temp}Â°C`;
      descriptionElement.innerText = desc.charAt(0).toUpperCase() + desc.slice(1);
      windElement.innerText = `${Math.round(data.wind.speed * 3.6)} km/h`;
      humidityElement.innerText = `${data.main.humidity}%`;
      pressureElement.innerText = `${data.main.pressure} hPa`;
      
      setBackground(currentWeather, isNight);
      setMusicPlaylist(currentWeather, isNight);
      foodSuggestionElement.innerText = foodSuggestions(desc);
    }

    function fetchWeather(city) {
      showLoader();
      hideError();
      
      fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`)
        .then(res => {
          if (!res.ok) {
            throw new Error('City not found');
          }
          return res.json();
        })
        .then(data => {
          updateWeatherUI(data);
          hideLoader();
        })
        .catch(err => {
          showError(`â ${err.message || 'Failed to fetch weather data'}`);
        });
    }

    function hideError() {
      errorMessage.style.display = 'none';
    }

    // --- AUTO LOCATION ---
    function fetchWeatherByLocation() {
      if (navigator.geolocation) {
        showLoader();
        navigator.geolocation.getCurrentPosition(
          pos => {
            const { latitude, longitude } = pos.coords;
            fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${API_KEY}&units=metric`)
              .then(res => {
                if (!res.ok) {
                  throw new Error('Location not found');
                }
                return res.json();
              })
              .then(data => {
                updateWeatherUI(data);
                searchBox.value = data.name;
                hideLoader();
              })
              .catch(err => {
                showError(`â ${err.message || 'Failed to get location weather'}`);
                fetchWeather("London"); // Default city
              });
          },
          err => {
            showError('â Location access denied. Showing default city.');
            fetchWeather("London"); // Default city
          }
        );
      } else {
        showError('â Geolocation not supported. Showing default city.');
        fetchWeather("London"); // Default city
      }
    }

    // --- SEARCH ---
    searchBox.addEventListener("keypress", e => {
      if (e.key === "Enter") {
        const city = e.target.value.trim();
        if (city) {
          fetchWeather(city);
        }
      }
    });

    // --- MUSIC CONTROL ---
    toggleMusicButton.addEventListener('click', () => {
      isMusicPlaying = !isMusicPlaying;
      
      if (isMusicPlaying) {
        toggleMusicButton.innerHTML = '<i class="fas fa-volume-up"></i>';
        trackInfoElement.textContent = `Now playing: ${currentPlaylist[currentTrackIndex].name}`;
        music.play().catch(e => {
          console.log("Audio play failed:", e);
          isMusicPlaying = false;
          toggleMusicButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
          trackInfoElement.textContent = "Background music: Off";
        });
      } else {
        toggleMusicButton.innerHTML = '<i class="fas fa-volume-mute"></i>';
        trackInfoElement.textContent = "Background music: Off";
        music.pause();
      }
    });

    // --- PLAYLIST CONTROL ---
    nextTrackButton.addEventListener('click', playNextTrack);
    prevTrackButton.addEventListener('click', playPrevTrack);

    // --- AUTOPLAY WHEN TRACK ENDS ---
    music.addEventListener('ended', playNextTrack);

    // --- INITIALIZE APP ---
    fetchWeatherByLocation();
  </script>
</body>
</html>